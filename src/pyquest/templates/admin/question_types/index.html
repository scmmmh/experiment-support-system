<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>QuestionTypes</title>
    <script>
    function set_enabled_state(item, enabled) {
        item.children('ol').children('li').each(function() {
            set_enabled_state($(this), item.children('input[type=checkbox]').data('pyquest-enabled'));
        });
        console.log(item.children('input[type=checkbox]').data('pyquest-enabled'));
    	if(item.children('input[type=checkbox]').data('pyquest-enabled')) {
    		item.children('label').css('color', '');
            item.children('ol').sortable('enabled');
    	} else {
            item.children('label').css('color', '#aaaaaa');
            item.children('ol').sortable('disable');
    	}
    }
    $(document).ready(function() {
    	$('#qt_form ol').sortable({
    		distance: 10,
    		update: function(e, ui) {
    			var sortable = ui.item.parent();
    			console.log(sortable.sortable('toArray'));
    			sortable.parent().children('span').children('.role-order').val(sortable.sortable('toArray').join(','));
    		}
    	});
        $('#qt_form input[type=checkbox]').change(function() {
    		var checkbox = $(this);
    		var parent = checkbox.parent();
    		if(this.checked) {
                parent.find('input[type=checkbox]').data('pyquest-enabled', true);
    		} else {
                parent.find('input[type=checkbox]').data('pyquest-enabled', false);
                checkbox.data('pyquest-enabled', true);
    		}
    		set_enabled_state(parent, true);
    	});
        $('#qt_form input[type=checkbox]').click(function() {
        	console.log($(this).data('pyquest-enabled'));
        	if($(this).data('pyquest-enabled')) {
        		return true;
        	} else {
        		return false;
        	}
        });
        $('#qt_form').children('ol').children('li').each(function() {
        	set_enabled_state($(this), true);
        });
    	$('.role-expand').click(function() {
            var btn = $(this);
            var parent = btn.parent();
            btn.hide();
            parent.children('.role-collapse').show();
            parent.children('ol').slideDown();
            return false;
    	});
    	$('.role-collapse').click(function() {
    		var btn = $(this);
    		var parent = btn.parent();
    		btn.hide();
    		parent.children('.role-expand').show();
    		parent.children('ol').slideUp();
            return false;
    	});
    });
    </script>
  </head>
  <body>
    ${h.ui.breadcrumbs([('Question Types', {'href': r.route_url('admin.question_types')})], r)}
    <nav class="toolbar">
      <ul>
        <li><a href="${r.route_url('admin.question_types.import')}" class="button">Import Question Types</a></li>
      </ul>
    </nav>
    <article>
    <hgroup>
      <h1>Question Types</h1>
    </hgroup>
    <form id="qt_form" action="${r.current_route_url()}" method="post">
      ${h.form.csrf_token_field(r.session.get_csrf_token())}
      ${h.form.hidden_field('order.top', ','.join(['qtg_%i' % (qtg.id) for qtg in question_type_groups]), class_='role-order')}
      <ol>${h.qsheet.admin_question_type_list(r, question_type_groups)}</ol>
      <ul class="buttons">
        <li>${h.form.submit('Save changes', class_='button')}</li>
      </ul>
    </form>
    </article>
  </body>
</html>