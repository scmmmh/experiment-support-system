<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" py:strip="True">
  <head py:match="head">
    <title>${select('title/text()')}</title>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/screen.css')}"/>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/backend.css')}"/>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/buttons/screen.css')}"/>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/jquery-ui/screen.css')}"/>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/qtip2.min.css')}"/>
    ${select('link')}
    ${select('style')}
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/jquery-1.7.1.min.js')}"></script>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/jquery-ui-1.8.17.min.js')}"></script>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/ckeditor/ckeditor.js')}"></script>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/ckeditor/adapters/jquery.js')}"></script>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/qtip2.min.js')}"></script>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/backend.js')}"></script>
    <script type="text/javascript">
    $(document).ready(function() {
    	setTimeout(function() {
    	    $('header.flash').animate({height: '0px'}, 500);
    	}, 2000);
    	$('header.flash').click(function(ev, ui) {$(this).hide();});
    	$('.post-submit').click(post_submit);
        $('*[data-qtip-new!=""]').qtip({
        	content: {
        		attr: 'data-qtip-new',
        		title: {
        			text: 'Welcome to PyQuestionnaire',
        			button: true
        		}
        	},
            position: {
                my: 'top center',
                at: 'bottom center'
            },
            show: {
            	delay: 0,
            	event: '',
                ready: true
            },
            hide: {
            	event: 'unfocus'
            },
            style: {
                classes: 'ui-tooltip-dark ui-tooltip-shadow'
            }
        });
        $('.button[title], a[title]').qtip({
            position: {
                my: 'top center',
                at: 'bottom center'
            },
            show: {
                delay: 500
            },
            style: {
                classes: 'ui-tooltip-dark ui-tooltip-shadow'
            }
        });
        $('input[type="text"][title],select[title]').qtip({
            position: {
                my: 'center left',
                at: 'center right'
            },
            show: {
                event: 'focus',
                solo: true
            },
            hide: {
                event: 'unfocus'
            },
            style: {
                classes: 'ui-tooltip-dark ui-tooltip-shadow'
            }
        });
        $('textarea[title]').qtip({
            position: {
                my: 'top center',
                at: 'bottom center'
            },
            show: {
                event: 'focus',
                solo: true
            },
            hide: {
                event: 'unfocus'
            },
            style: {
                classes: 'ui-tooltip-dark ui-tooltip-shadow'
            }
        });
    	setup_status_changer();
    });
    CSRF_TOKEN = '${r.session.get_csrf_token()}';
    </script>
    ${select('script')}
  </head>
  <body py:match="body">
    <div class="container">
      <header class="span-20 flash">
        <ul py:if="r.session.peek_flash('info') or r.session.peek_flash('warn') or r.session.peek_flash('auth')" class="no-symbol no-margin">
          <li py:for="flash in r.session.pop_flash('info')" class="info">${flash}</li>
          <li py:for="flash in r.session.pop_flash('warn')" class="error">${flash}</li>
          <li py:for="flash in r.session.pop_flash('auth')" class="error">${flash}</li>
        </ul>
      </header>
      ${h.user.menu(r)}
      <nav id="admin-menu">
        <ul>
          <li py:if="h.auth.is_authorised(':user.has_permission(\'admin.users\')', {'user': h.user.current_user(r)})"><a href="${r.route_url('user')}">Administer Users</a></li>
          <li py:if="h.auth.is_authorised(':user.has_permission(\'admin.groups\')', {'user': h.user.current_user(r)})"><a href="${r.route_url('group')}">Administer Groups</a></li>
        </ul>
      </nav>
      ${select('*')}
      <footer class="span-24">
        Powered by <a href="http://pyquestionnaire.readthedocs.org/en/latest/index.html">PyQuestionnaire</a>
      </footer>
    </div>
  </body>
</html>