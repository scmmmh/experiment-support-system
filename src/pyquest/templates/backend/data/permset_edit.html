<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>Edit Permutation Set</title>
    <script type="text/javascript">
    function update_counts() {
    	$('#participants_count').html('Calculating...');
    	$.ajax('${r.route_url('data.edit.permset.count', sid=survey.id)}', {
    		data: $('form').serialize(),
    		type: 'POST'
    	}).success(function(data) {
    		$('#participants_count').html(data.count);
    	}).error(function(data) {
    		$('#participants_count').html('Could not determine the required number of participants');
    	});
    }
    $(document).ready(function() {
        $('select').change(update_counts);
        update_counts();
    });
    </script>
  </head>
  <body>
    ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)}),('Data', {'href': r.route_url('data.list', sid=survey.id)}), (h.text.title(permset.name), {'href': r.route_url('data.view', sid=survey.id, dsid=permset.id)}), ('Edit', {'href': r.current_route_url()})], r)}
    ${h.survey.fancy_status(r, survey, class_='survey-status right')}
    ${h.ui.main_menu('data', survey, r)}
    <article>
      <hgroup>
        <h1>Edit Permutation Set</h1>
      </hgroup>
      <form action="${r.route_url('data.edit.permset', sid=survey.id, dsid=permset.id)}" method="post">
        ${h.form.csrf_token_field(r.session.get_csrf_token())}
        <dl>
          <dt>Name</dt>
          <dd>${h.form.text_field('name', permset.name, e, class_='span-12')}</dd>
          <dt>Tasks</dt>
          <dd>
            ${h.form.select('tasks_mode', permset.tasks.data['mode'], [('between', 'Between'), ('within', 'Within')], e)}
            ${h.form.select('tasks', permset.tasks.object_id, [(-1, '--- Please select a data set of tasks ---')] + [(d.id, d.name) for d in survey.data_sets], e)}
          </dd>
          <dt>Interfaces</dt>
          <dd>
            ${h.form.select('interfaces_mode', permset.interfaces.data['mode'], [('between', 'Between'), ('within', 'Within')], e)}
            ${h.form.select('interfaces', permset.interfaces.object_id, [(-1, '--- Please select a data set of tasks ---')] + [(d.id, d.name) for d in survey.data_sets], e)}
          </dd>
          <dt>Participants required</dt>
          <dd id="participants_count"></dd>
        </dl>
        <ul class="buttons span-22">
          <li>${h.form.button("Don't Update", class_='button', onclick="document.location='%s'" % r.route_url('data.list', sid=survey.id))}</li>
          <li>${h.form.submit("Update", class_='button')}</li>
        </ul>
      </form>
    </article>
  </body>
</html>
