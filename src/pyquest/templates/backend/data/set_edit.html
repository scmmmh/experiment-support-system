<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>Edit Data Item Set</title>
    <script type="text/javascript">
      $(document).ready(function() {
    	  $('#data-filter-form input[type=submit]').hide();
    	  $('#data-filter-form select').change(function(ev, ui) {
    		 $('#data-filter-form').submit(); 
    	  });
      });
    </script>
  </head>
  <body>
    ${h.ui.dataset_breadcrumbs([(dis.name, {'href': ''}), ('Edit', {'href': r.route_url('dataset.edit', disid=dis.id)})], r)}
    <nav class="toolbar">
      <ul>
        <py:if test="h.auth.is_authorised(':user.has_permission(\'survey.edit-all\')', {'user': h.user.current_user(r), 'dis': dis})">
<!--          <li><a href="${r.route_url('survey.data.new', sid=survey.id, disid=dis.id)}" class="button">Add Item</a></li>-->
          <li><a href="${r.route_url('dataset.delete', disid=dis.id)}" class="button">Delete</a></li>
        </py:if>
      </ul>
    </nav>
    <article>
      <hgroup>
        <h1>Edit Data Item Set: ${dis.id},${dis.name}</h1>
      </hgroup>
      <form action="${r.route_url('dataset.edit', disid=dis.id)}" method="post">
        ${h.form.csrf_token_field(r.session.get_csrf_token())}
	<div class="span-24" style="overflow:auto;">
          <dt>Name</dt>
          <dd>${h.form.text_field('name', dis.name, e, class_='span-12')}</dd>
          <table>
            <thead>
              <tr py:if="dis.items">
		<th>Control item</th>
		<th>Internal id</th>
		<th py:for="attribute in dis.items[0].attributes">${attribute.key}</th>
		<th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr py:if="len(dis.items) == 0">
		<td class="placeholder">There is currently no data attached to this survey. Use the "Upload data" button to
                  upload a CSV (Comma-Separated-Value) file with data.</td>
              </tr>
              <tr py:for="item in dis.items">
		<td><py:if test="item.control">Yes</py:if></td>
                <td>${item.id}</td>
		<td py:for="attribute in item.attributes">${attribute.value}</td>
		<td>
                  <ul class="inline no-symbol no-margin">
                    <li><a href="${r.route_url('data.edit', did=item.id)}" class="button">Edit</a></li>
                    <li><a href="${r.route_url('data.delete', did=item.id)}" class="button post-submit" data-confirm="Please confirm that you wish to delete this data item.">Delete</a></li>
                  </ul>
		</td>
              </tr>
            </tbody>
          </table>
          <ul class="buttons span-22">
            <li>${h.form.button("Don't update", class_='button', onclick="document.location='%s'" % r.route_url('dataset.list'))}</li>
            <li>${h.form.submit('Update', class_='button')}</li>
          </ul>
	</div>
      </form>
    </article>
  </body>
</html>
