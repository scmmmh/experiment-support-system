<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>${qsheet.title} - Add Data</title>
    <script type="text/javascript">
    $(document).ready(function() {
        $('#add-control-answer-btn').click(function() {
            $('#control-answers').append('<li>${h.form.select('control_answer_question', '', h.data.question_select(qsheet), None)}${h.form.text_field('control_answer_answer', '', None)}</li>');
            return false;
        });
        $('#control_item').change(function() {
            var checked = !($('#control_item:checked').length == 0);
            if(checked) {
                $('#add-control-answer-btn, input[name=control_answer]').removeAttr('disabled');
            } else {
                $('#add-control-answer-btn, input[name=control_answer]').attr('disabled', 'disabled');
            }
        });
        if($('#control_item:checked').length == 0) {
            $('#add-control-answer-btn, input[name=control_answer]').attr('disabled', 'disabled');
        }
    });
    </script>
  </head>
  <body>
    ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)}), (qsheet.title, {'href': r.route_url('survey.qsheet.view', sid=survey.id, qsid=qsheet.id)}), ('Data', {'href': r.route_url('survey.data', sid=survey.id, qsid=qsheet.id)}), ('New', {'href': r.route_url('survey.data.new', sid=survey.id, qsid=qsheet.id)})], r)}
    ${h.survey.fancy_status(r, survey, class_='survey-status right')}
    ${h.ui.main_menu('data', survey, r)}
    <article>
      <div py:if="survey.status in ['running', 'paused', 'finished'] and len(survey.participants) > 0" class="error">The survey is currently ${h.survey.status(survey.status, True)}
        and any changes you make here will not be reflected in the answers that have already been provided by the participants.</div>
      <hgroup>
        <h1>${qsheet.title} - Add Data</h1>
      </hgroup>
      <form action="${r.route_url('survey.data.new', sid=survey.id, qsid=qsheet.id)}" method="post">
        ${h.form.csrf_token(r.session.get_csrf_token())}
        <dl>
          <dt><label for="control_item">Control item</label></dt>
          <dd>${h.form.checkbox('control_', 'True', e, checked=data_item.control, label='Yes', id='control_item')}</dd>
          <py:for each="attribute in data_item.attributes">
            <dt>${h.text.title(attribute.key)}</dt>
            <dd>${h.form.text_field(attribute.key, '', e, class_='span-12')}</dd>
          </py:for>
          <dt>Control Answers</dt>
          <dd>
            <ul id="control-answers" class="no-symbol no-margin">
            </ul>
            <button id="add-control-answer-btn" class="button">Add an answer</button>
          </dd>
        </dl>
        <ul class="buttons span-12">
          <li>${h.form.button("Don't add", class_='button', onclick="document.location='%s'" % r.route_url('survey.data', sid=survey.id, qsid=qsheet.id))}</li>
          <li>${h.form.submit('Add', class_='button')}</li>
        </ul>
      </form>
    </article>
  </body>
</html>