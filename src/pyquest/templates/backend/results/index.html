<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>${survey.title} - Results</title>
  </head>
  <body>
    ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)}), ('Results', {'href': r.route_url('survey.preview', sid=survey.id)})], r)}
    ${h.survey.fancy_status(r, survey, class_='survey-status right')}
    ${h.ui.main_menu('results', survey, r)}
    <nav class="toolbar">
      <ul>
        <li><a href="${r.route_url('survey.results.by_question', sid=survey.id)}" class="button">By Question</a></li>
        <li><a href="${r.route_url('survey.results.by_participant', sid=survey.id)}" class="button">By Participant</a></li>
      </ul>
    </nav>
    <article>
      <hgroup>
        <h1>${survey.title} - Results</h1>
      </hgroup>
      <table>
        <thead>
          <tr>
            <th class="text-center">Pages</th>
            <th class="text-center">Questions</th>
            <th class="text-center">Participants (Completed)</th>
            <th class="text-center">Participants (Total)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center" style="font-size:28pt;font-weight:bold;">${len(survey.qsheets)}</td>
            <td class="text-center" style="font-size:28pt;font-weight:bold;">${len([q for qsheet in survey.qsheets for q in qsheet.questions])}</td>
            <td class="text-center" style="font-size:28pt;font-weight:bold;">${h.results.completed_count(survey)}</td>
            <td class="text-center" style="font-size:28pt;font-weight:bold;">${len(survey.participants)}</td>
          </tr>
        </tbody>
      </table>
      <section py:for="qsheet in survey.qsheets">
        <hgroup>
          <h2>${qsheet.title}</h2>
        </hgroup>
        <table> 
          <thead>
            <tr>
              <th>Question</th>
              <th>No. of Answers</th>
              <th>Sample</th>
            </tr>
          </thead>
          <tbody>
            <py:for each="question in qsheet.questions" py:if="question.type != 'text'">
              <py:if test="question.type in ['rating_group', 'multichoice_group']">
                <tr py:for="sub_quest in h.qsheet.get_attr_groups(question, 'subquestion')">
                  <td>${question.name}.${h.qsheet.get_qg_attr_value(sub_quest, 'name')}</td>
                  <td>${len(question.answers)}</td>
                  <td>${h.results.sample_answer(question, h.qsheet.get_qg_attr_value(sub_quest, 'name'))}</td>
                </tr>
              </py:if>
              <py:if test="question.type not in ['rating_group', 'multichoice_group']">
                <tr>
                  <td>${question.name}</td>
                  <td>${len(question.answers)}</td>
                  <td>${h.results.sample_answer(question)}</td>
                </tr>
              </py:if>
            </py:for>
          </tbody>
        </table>
      </section>
    </article>
  </body>
</html>