<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>${survey.title} - Preview</title>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/frontend.css')}"/>
    <link rel="stylesheet" type="text/css" href="${r.static_url('pyquest:static/css/themes/basic.css')}"/>
    <style type="text/css">${survey.styles}</style>
    <style type="text/css" py:for="qsheet in survey.qsheets">${qsheet.styles}</style>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/jquery-1.7.1.min.js')}"></script>
    <script type="text/javascript" src="${r.static_url('pyquest:static/js/jquery-ui-1.8.17.min.js')}"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        $('.question.ranking ul select').hide();
        $('.question.ranking ul').sortable({
            update: function(e, ui) {
                var items = $(this).sortable('toArray');
                for(var idx in items) {
                    var id = '#' + items[idx].replace(/\./g, '\\.');
                    id = id.substring(0, id.length - 5);
                    $(id).val(idx);
                }
            }
        });
    });
    </script>
    <script type="text/javascript">${survey.scripts}</script>
    <script type="text/javascript" py:for="qsheet in survey.qsheets">${qsheet.scripts}</script>
  </head>
  <body>
    <div class="container">
      ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)}), ('Preview', {'href': r.route_url('survey.preview', sid=survey.id)})], r)}
      ${h.survey.fancy_status(r, survey, class_='survey-status right')}
      ${h.ui.main_menu('preview', survey, r)}
      <div class="info text-center" py:if="survey.status == 'running'">This survey is live and can be accessed at <a href="${r.route_url('survey.run', sid=survey.id)}">${r.route_url('survey.run', sid=survey.id)}</a>.</div>
    </div>
    <article class="survey">
      <hgroup>
        <h1>${survey.title} - Preview</h1>
      </hgroup>
      <section id="${qsheet.name}" py:for="qsheet in qsheets" class="qsheet" py:with="example=h.data.sample_for_qsheet(qsheet)">
        <hgroup>
          <h1><a href="${r.route_url('survey.qsheet.view', sid=survey.id, qsid=qsheet.id)}">${qsheet.title}</a></h1>
        </hgroup>
        <form action="${r.route_url('survey.qsheet.view', sid=survey.id, qsid=qsheet.id)}" method="post">
          ${h.form.hidden_field('items.%i.csrf_token_' % (example['did']), r.session.get_csrf_token())}
          <py:for each="question in qsheet.questions">${h.qsheet.display(question, example, e)}</py:for>
          <ul class="buttons">
            <li>${h.form.submit('Test validation', class_='button')}</li>
          </ul>
        </form>
      </section>
    </article>
  </body>
</html>