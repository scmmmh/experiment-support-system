<pq:experiment title="${survey.title}" xmlns:pq="http://paths.sheffield.ac.uk/pyquest" xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <pq:summary>${survey.summary}</pq:summary>
  <pq:language>${survey.language}</pq:language>
  <pq:styles>${survey.styles}</pq:styles>
  <pq:scripts>${survey.scripts}</pq:scripts>
  <pq:first_page>${survey.start.name if survey.start else ''}</pq:first_page>
  <pq:pages>
    <xi:include href="../qsheet/export.xml" py:for="qsheet in survey.qsheets"/>
  </pq:pages>
  <pq:transitions>
    <pq:transition py:for="transition in [t for qs in survey.qsheets for t in qs.next]" from="${transition.source.name}" order="${transition.order}" py:attrs="{'to': transition.target.name if transition.target else None}">
      <pq:condition py:if="transition.condition">
        <pq:answer py:if="transition.condition['type'] == 'answer'" question="${transition.condition['question']}" answer="${transition.condition['answer']}"/>
        <pq:permutation py:if="transition.condition['type'] == 'permutation'" permutation="${transition.condition['permutation']}"/>
      </pq:condition>
    </pq:transition>
  </pq:transitions>
  <pq:data>
    <pq:data_set py:for="data_set in survey.data_sets" name="${data_set.name}">
      <pq:attached_to py:for="qsheet in data_set.qsheets">${qsheet.name}</pq:attached_to>
    </pq:data_set>
    <pq:permutation_set py:for="perm_set in survey.permutation_sets" name="${perm_set.name}">
      <pq:attached_to py:for="qsheet in perm_set.qsheets">${qsheet.name}</pq:attached_to>
    </pq:permutation_set>
  </pq:data>
</pq:experiment>