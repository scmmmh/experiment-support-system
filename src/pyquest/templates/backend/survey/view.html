<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>${survey.title}</title>
  </head>
  <body>
    ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)})], r)}
    ${h.survey.fancy_status(r, survey.status, class_='survey-status right')}
    ${h.ui.main_menu('survey', survey, r)}
    <nav class="toolbar">
      <ul>
        <py:if test="h.auth.is_authorised(':survey.is-owned-by(:user) or :user.has_permission(\'survey.edit-all\')', {'user': h.user.current_user(r), 'survey': survey})">
          <li><a href="${r.route_url('survey.qsheet.new', sid=survey.id)}" class="button">Add page</a></li>
          <li><a href="${r.route_url('survey.edit', sid=survey.id)}" class="button">Edit</a></li>
        </py:if>
        <li py:if="h.auth.is_authorised(':survey.is-owned-by(:user) or :user.has_permission(\'survey.delete-all\')', {'user': h.user.current_user(r), 'survey': survey})"><a href="${r.route_url('survey.delete', sid=survey.id)}" class="button post-submit" data-confirm="Please confirm that you wish to delete the survey &quot;${survey.title}&quot; including its pages, data, and results.">Delete</a></li>
        <py:if test="h.auth.is_authorised(':survey.is-owned-by(:user) or :user.has_permission(\'survey.edit-all\')', {'user': h.user.current_user(r), 'survey': survey})">
          <li py:if="survey.status == 'develop'"><a href="${r.route_url('survey.status', sid=survey.id, _query={'status': 'testing'})}" class="button post-submit" data-confirm="no-confirm">Test</a></li>
          <li py:if="survey.status == 'testing'"><a href="${r.route_url('survey.status', sid=survey.id, _query={'status': 'develop'})}" class="button post-submit" data-confirm="no-confirm">Stop Test</a></li>
          <li py:if="survey.status in ['develop', 'paused', 'finished']"><a href="${r.route_url('survey.status', sid=survey.id, _query={'status': 'running'})}" class="button post-submit" data-confirm="no-confirm">Start</a></li>
          <li py:if="survey.status == 'running'"><a href="${r.route_url('survey.status', sid=survey.id, _query={'status': 'paused'})}" class="button post-submit" data-confirm="no-confirm">Pause</a></li>
          <li py:if="survey.status in ['running', 'paused']"><a href="${r.route_url('survey.status', sid=survey.id, _query={'status': 'finished'})}" class="button post-submit" data-confirm="no-confirm">Finish</a></li>
        </py:if>
      </ul>
    </nav>
    <article>
      <hgroup>
        <h1>${survey.title}</h1>
      </hgroup>
      <p>${survey.summary}</p>
      <table>
        <thead>
          <tr>
            <th class="center">Pages</th>
            <th class="center">Data Items</th>
            <th class="center">Participants</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="center" style="font-size:28pt;font-weight:bold;"><a href="${r.route_url('survey.qsheet', sid=survey.id)}" style="text-decoration:none;">${len(survey.qsheets)}</a></td>
            <td class="center" style="font-size:28pt;font-weight:bold;"><a href="${r.route_url('survey.data', sid=survey.id, _query={'show':'data'})}" style="text-decoration:none;">${len(survey.data_items)}</a></td>
            <td class="center" style="font-size:28pt;font-weight:bold;"><a href="${r.route_url('survey.results', sid=survey.id)}" style="text-decoration:none;">${len(survey.participants)}</a></td>
          </tr>
        </tbody>
      </table>
    </article>
  </body>
</html>