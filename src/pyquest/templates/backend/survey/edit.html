<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>${survey.title} - Edit</title>
    <script type="text/javascript">
    $(document).ready(function() {
        make_toggle_link('role-css-edit');
        make_toggle_link('role-js-edit');
        $('#survey-pages li').each(function() {
        	var item = $(this);
        	if(item.find('.role-qsheet-repeat').val() == 'single') {
        		item.find('.role-qsheet-data-items, .role-qsheet-control-items').attr('disabled', 'disabled');
        	}
        	item.find('.role-qsheet-repeat').change(function() {
        		if($(this).val() == 'single') {
        			item.find('.role-qsheet-data-items, .role-qsheet-control-items').attr('disabled', 'disabled');
        		} else {
        			item.find('.role-qsheet-data-items, .role-qsheet-control-items').removeAttr('disabled');
        		}
        	})
        });
    });
    </script>
  </head>
  <body>
    ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)}), ('Edit', {'href': r.route_url('survey.edit', sid=survey.id)})], r)}
    ${h.survey.fancy_status(r, survey, class_='survey-status right')}
    ${h.ui.main_menu('survey', survey, r)}
    <article>
      <div py:if="survey.status in ['running', 'paused', 'finished'] and len(survey.participants) > 0" class="error">The survey is currently ${h.survey.status(survey.status, True)}
        and any changes you make here will not be reflected in the answers that have already been provided by the participants.</div>
      <hgroup>
        <h1>${survey.title} - Edit</h1>
      </hgroup>
      <form action="${r.route_url('survey.edit', sid=survey.id)}" method="post">
        ${h.form.csrf_token(r.session.get_csrf_token())}
        <dl>
          <dt>Title</dt>
          <dd>${h.form.text_field('title', survey.title, e, class_='span-12')}</dd>
          <dt>Summary</dt>
          <dd>${h.form.textarea('summary', survey.summary, e, class_='span-22', style='height:5em;')}</dd>
          <dt class="role-css-edit-toggle">CSS styles</dt>
          <dd>${h.form.textarea('styles', survey.styles, e, class_='span-22 role-css-edit')}</dd>
          <dt class="role-js-edit-toggle">Javascript</dt>
          <dd>${h.form.textarea('scripts', survey.scripts, e, class_='span-22 role-js-edit')}</dd>
          <dt>First page</dt>
          <dd>${h.form.select('start', survey.start_id, [(qs.id, qs.title) for qs in survey.qsheets], e)}</dd>
          <dt>Pages</dt>
          <dd>
            <ul id="survey-pages">
              <li class="placeholder" py:if="not survey.qsheets">This survey currently has no pages. <a href="${r.route_url('survey.qsheet.new', sid=survey.id)}">Add a page now</a></li>
              <li class="item" py:for="qsheet in survey.qsheets">
                <hgroup>
                  <h2 class="header">${qsheet.title}</h2>
                </hgroup>
                <div class="content">
                  <dl>
                    <dt>Type</dt>
                    <dd>${h.form.select('%i.repeat' % (qsheet.id), h.qsheet.get_qs_attr_value(qsheet, 'repeat'), [('single', 'Single'), ('repeat', 'Repeated')], e, class_='role-qsheet-repeat')}</dd>
                    <dt>Data Items</dt>
                    <dd>${h.form.number_field('%i.data_items' % (qsheet.id), h.qsheet.get_qs_attr_value(qsheet, 'data-items'), e, class_='role-qsheet-data-items')}</dd>
                    <dt>Control Items</dt>
                    <dd>${h.form.number_field('%i.control_items' % (qsheet.id), h.qsheet.get_qs_attr_value(qsheet, 'control-items'), e, class_='role-qsheet-control-items')}</dd>
                    <dt>Transition to</dt>
                    <dd>${h.form.select('%i.transition' % (qsheet.id), qsheet.next[0].target.id if len(qsheet.next) > 0 else None, [('', '--- Finish ---')] + [(qs.id, qs.title) for qs in survey.qsheets if qs.id != qsheet.id], e)}</dd>
                  </dl>
                </div>
              </li>
            </ul>
          </dd>
        </dl>
        <ul class="buttons span-22">
          <li>${h.form.button("Don't update", class_='button', onclick="document.location='%s'" % r.route_url('survey.view', sid=survey.id))}</li>
          <li>${h.form.submit('Update', class_='button')}</li>
        </ul>
      </form>
    </article>
  </body>
</html>