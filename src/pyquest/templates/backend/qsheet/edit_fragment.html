<li class="item" xmlns:py="http://genshi.edgewall.org/">
  ${h.form.hidden_field('%i.id' % (question.id), question.id, class_='role-id')}
  ${h.form.hidden_field('%i.order' % (question.id), idx, class_='role-order')}
  <hgroup>
    <h2 class="header">
      <span class="title">${h.qsheet.question_type_title(question.type)}</span>
      <ul class="no-symbol no-margin no-padding inline right">
        <li py:if="question.type == 'text'"><a href="#" class="button action-edit-text"><span class="ui-icon ui-icon-pencil"></span></a></li>
        <li><a href="${r.route_url('survey.qsheet.edit.delete_question', sid=question.qsheet.survey.id, qsid=question.qsheet.id, qid=question.id)}" class="button action-delete"><span class="ui-icon ui-icon-closethick"></span></a></li>
      </ul>
    </h2>
  </hgroup>
  <div class="content">
    <py:if test="question.type == 'text'">
      ${h.form.textarea('%i.text' % (question.id), h.qsheet.get_q_attr_value(question, 'text.text'), e, class_='hidden role-stored-text')}
      <div class="role-editable-text">
        ${Markup(h.qsheet.get_q_attr_value(question, 'text.text'))}
      </div>
    </py:if>
    <py:if test="question.type != 'text'">
      <dl>
        <dt>Name</dt>
        <dd>${h.form.text_field('%i.name' % (question.id), question.name, e)}</dd>
        <dt>Title</dt>
        <dd>${h.form.text_field('%i.title' % (question.id), question.title, e, class_='span-16')}</dd>
        <dt>Help</dt>
        <dd>${h.form.textarea('%i.help' % (question.id), question.help, e, class_='span-16', style='height:50px;')}</dd>
        <dt>Required</dt>
        <dd>${h.form.checkbox('%i.required' % (question.id), 'true', e, checked=question.required, label='This question must be answered')}</dd>
        <py:if test="question.type == 'number'">
          <dt>Minimum value</dt>
          <dd>${h.form.number_field('%i.min' % (question.id), h.qsheet.get_q_attr_value(question, 'further.min'), e)}</dd>
          <dt>Maximum value</dt>
          <dd>${h.form.number_field('%i.max' % (question.id), h.qsheet.get_q_attr_value(question, 'further.max'), e)}</dd>
        </py:if>
        <py:if test="question.type == 'single_choice'">
          <dt>Display as</dt>
          <dd>${h.form.select('%i.display' % (question.id), h.qsheet.get_q_attr_value(question, 'further.subtype', 'table'), [('table', 'Horizontal table'), ('list', 'Vertical list'), ('select', 'Select box')], e)}</dd>
        </py:if>
        <py:if test="question.type in ['single_choice', 'rating_group', 'multichoice', 'multichoice_group', 'ranking']">
          <dt py:if="question.type in ['single_choice', 'rating_group', 'multichoice', 'multichoice_group']">Answers</dt>
          <dt py:if="question.type == 'ranking'">Items</dt>
          <dd>
            <table>
              <thead>
                <tr>
                  <th>Value</th>
                  <th>Label</th>
                  <th></th>
                </tr>
              </thead>
              <tbody class="role-answers">
                <tr py:for="attr_group in h.qsheet.get_attr_groups(question, 'answer')">
                  <td>${h.form.hidden_field('%i.answer-%i.order' % (question.id, attr_group.id), attr_group.order, class_='role-answer-order')}${h.form.text_field('%i.answer-%i.value' % (question.id, attr_group.id), h.qsheet.get_qg_attr_value(attr_group, 'value'), e)}</td>
                  <td>${h.form.text_field('%i.answer-%i.label' % (question.id, attr_group.id), h.qsheet.get_qg_attr_value(attr_group, 'label'), e)}</td>
                  <td py:if="question.type in ['single_choice', 'rating_group', 'multichoice', 'multichoice_group']"><a href="#" title="Remove this answer" class="button action-remove-answer"><span class="ui-icon ui-icon-minusthick"></span></a></td>
                  <td py:if="question.type == 'ranking'"><a href="#" title="Remove this item" class="button action-remove-answer"><span class="ui-icon ui-icon-minusthick"></span></a></td>
                </tr>
              </tbody>
            </table>
            <ul class="buttons">
              <li><a href="#" title="Add an answer" class="button action-add-answer"><span class="ui-icon ui-icon-plusthick"></span></a></li>
            </ul>
          </dd>
        </py:if>
        <py:if test="question.type in ['rating_group', 'multichoice_group']">
          <dt>Sub-questions</dt>
          <dd>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Label</th>
                  <th></th>
                </tr>
              </thead>
              <tbody class="role-subquestions">
                <tr py:for="attr_group in h.qsheet.get_attr_groups(question, 'subquestion')">
                  <td>${h.form.hidden_field('%i.sub_quest-%i.order' % (question.id, attr_group.id), attr_group.order, class_='role-subquestion-order')}${h.form.text_field('%i.sub_quest-%i.name' % (question.id, attr_group.id), h.qsheet.get_qg_attr_value(attr_group, 'name'), e)}</td>
                  <td>${h.form.text_field('%i.sub_quest-%i.label' % (question.id, attr_group.id), h.qsheet.get_qg_attr_value(attr_group, 'label'), e)}</td>
                  <td><a href="#" title="Remove this sub-question" class="button action-remove-subquestion"><span class="ui-icon ui-icon-minusthick"></span></a></td>
                </tr>
              </tbody>
            </table>
            <ul class="buttons">
              <li><a href="#" title="Add a sub-question" class="button action-add-subquestion"><span class="ui-icon ui-icon-plusthick"></span></a></li>
            </ul>
          </dd>
        </py:if>
        <py:if test="question.type == 'confirm'">
          <dt>Value</dt>
          <dd>${h.form.number_field('%i.value' % (question.id), h.qsheet.get_q_attr_value(question, 'further.value'), e, class_='span-16')}</dd>
          <dt>Label</dt>
          <dd>${h.form.number_field('%i.label' % (question.id), h.qsheet.get_q_attr_value(question, 'further.label'), e, class_='span-16')}</dd>
        </py:if>
      </dl>
    </py:if>
  </div>
</li>
