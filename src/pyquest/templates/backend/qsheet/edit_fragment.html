<li class="item" xmlns:py="http://genshi.edgewall.org/">
  ${h.form.hidden_field('%i.id' % (question.id), question.id, class_='role-id')}
  ${h.form.hidden_field('%i.order' % (question.id), idx, class_='role-order')}
  <hgroup>
    <h2 class="header">
      <span class="title">${question.q_type.title}</span>
      <ul class="no-symbol no-margin no-padding inline right">
        <li py:if="False and question.type == 'text'"><a href="#" class="button action-edit-text"><span class="ui-icon ui-icon-pencil"></span></a></li>
        <li><a href="${r.route_url('survey.qsheet.edit.delete_question', sid=question.qsheet.survey.id, qsid=question.qsheet.id, qid=question.id)}" class="button action-delete"><span class="ui-icon ui-icon-closethick"></span></a></li>
      </ul>
    </h2>
  </hgroup>
  <div class="content">
    <dl>
    <py:for each="part in question.q_type.backend_schema()">
        <py:if test="part['type'] == 'richtext'">
          <dt>
            <span class="right"><a href="#" class="button action-edit-text"><span class="ui-icon ui-icon-pencil"></span></a></span>
            ${h.form.textarea('%i.text' % (question.id), question.attr_value(part['attr']), e, class_='hidden role-stored-text')}
          </dt>
          <dd>
            <div class="role-editable-text">${Markup(question.attr_value(part['attr']))}</div>
          </dd>
        </py:if>
        <py:if test="part['type'] == 'question-name'">
          <dt>Name</dt>
          <dd>${h.form.text_field('%i.name' % (question.id), question.name, e, class_='role-question-name')}</dd>
        </py:if>
        <py:if test="part['type'] == 'question-title'">
          <dt>Title</dt>
          <dd>${h.form.text_field('%i.title' % (question.id), question.title, e, class_='span-16')}</dd>
        </py:if>
        <py:if test="part['type'] == 'question-help'">
          <dt>Help</dt>
          <dd>${h.form.textarea('%i.help' % (question.id), question.help, e, class_='span-16', style='height:50px;')}</dd>
        </py:if>
        <py:if test="part['type'] == 'question-required'">
          <dt>Required</dt>
          <dd>${h.form.checkbox('%i.required' % (question.id), 'true', e, checked=question.required, label='This question must be answered')}</dd>
        </py:if>
        <py:if test="part['type'] == 'int'">
          <dt>${part['title']}</dt>
          <dd>${h.form.number_field('%i.%s' % (question.id, part['name']), question.attr_value(part['attr']), e)}</dd>
        </py:if>
        <py:if test="part['type'] == 'unicode'">
          <dt>${part['title']}</dt>
          <dd>${h.form.text_field('%i.%s' % (question.id, part['name']), question.attr_value(part['attr']), e)}</dd>
        </py:if>
        <py:if test="part['type'] == 'select'">
          <dt>${part['title']}</dt>
          <dd>${h.form.select('%i.%s' % (question.id, part['name']), question.attr_value(part['attr'], part['default']), part['values'], e)}</dd>
        </py:if>
        <py:if test="part['type'] == 'table'">
          <dt>${part['title']}</dt>
          <dd>
            <table>
              <thead>
                <tr>
                  <th py:for="column in part['columns']">${column['title']}</th>
                  <th></th>
                </tr>
              </thead>
              <tfoot>
                <tr>
                  <td py:for="column in part['columns']"></td>
                  <td><a href="#" title="Add a row" class="button action-add-row" data-pyquest-qid="${question.id}" data-pyquest-part="${h.json.dumps(part)}"><span class="ui-icon ui-icon-plusthick"></span></a></td>
                </tr>
              </tfoot>
              <tbody class="role-sortable">
                <tr py:for="group in question.attr_group(part['attr'], default=[], multi=True)">
                  <td py:for="column in part['columns']">
                    <py:if test="column['type'] == 'unicode'">${h.form.text_field('%i.%s-%i.%s' % (question.id, part['name'], group.id, column['name']), group.attr_value(column['attr']), e)}</py:if>
                  </td>
                  <td>${h.form.hidden_field('%i.%s-%i._order' % (question.id, part['name'], group.id), group.order, class_='role-row-order')}<a href="#" title="Remove this row" class="button action-remove-row"><span class="ui-icon ui-icon-minusthick"></span></a></td>
                </tr>
              </tbody>
            </table>
          </dd>
        </py:if>
      </py:for>
    </dl>
  </div>
</li>
