<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../../layout/backend.html"/>
  <head>
    <title>${survey.title} - ${qsheet.title} - Edit source</title>
  </head>
  <body>
    ${h.ui.survey_breadcrumbs([(survey.title, {'href': r.route_url('survey.view', sid=survey.id)}), (qsheet.title, {'href': r.route_url('survey.qsheet.view', sid=survey.id, qsid=qsheet.id)}), ('Edit source', {'href': r.route_url('survey.qsheet.edit.source', sid=survey.id, qsid=qsheet.id)})], r)}
    ${h.survey.fancy_status(r, survey, class_='survey-status right')}
    ${h.ui.main_menu('survey', survey, r)}
    <nav class="toolbar">
      <ul>
        <li><a href="${r.route_url('survey.qsheet.edit', sid=survey.id, qsid=qsheet.id)}" class="button">Edit Graphically</a></li>
        <li py:if="h.auth.is_authorised(':survey.is-owned-by(:user) or :user.has_permission(\'survey.edit-all\')', {'user': h.user.current_user(r), 'survey': survey})"><a href="${r.route_url('survey.qsheet.data', sid=survey.id, qsid=qsheet.id)}" class="button">Data</a></li>
      </ul>
    </nav>
    <article>
      <div py:if="survey.status in ['running', 'paused', 'finished'] and len(survey.participants) > 0" class="error">The experiment is currently ${h.survey.status(survey.status, True)}
        and any changes you make here will not be reflected in the answers that have already been provided by the participants.</div>
      <hgroup>
        <h1>${qsheet.title} - Edit source</h1>
      </hgroup>
      <form action="${r.route_url('survey.qsheet.edit.source', sid=survey.id, qsid=qsheet.id)}" method="post">
        ${h.form.csrf_token_field(r.session.get_csrf_token())}
        <dl>
          <dt>Name</dt>
          <dd>${h.form.text_field('name', qsheet.name, e)}</dd>
          <dt>Title</dt>
          <dd>${h.form.text_field('title', qsheet.title, e)}</dd>
          <dt>Type</dt>
          <dd>${h.form.select('repeat', qsheet.attr_value('repeat', default='single'), [('single', 'Single'), ('repeat', 'Repeated')], e, class_='role-qsheet-repeat')}</dd>
          <dt>Data Items</dt>
          <dd>${h.form.number_field('data_items', qsheet.attr_value('data-items', default='0'), e, class_='role-qsheet-data-items')}</dd>
          <dt>Control Items</dt>
          <dd>${h.form.number_field('control_items', qsheet.attr_value('control-items', default='0'), e, class_='role-qsheet-control-items')}</dd>
          <dt>Show Question Numbers</dt>
          <dd>${h.form.select('show_question_numbers', qsheet.attr_value('show-question-numbers', default='yes'), [('yes', 'Yes'), ('no', 'No')], e, class_='role-qsheet-show-question-numbers')}</dd>
	  <dt>Transition</dt>
	  <dd class="transition"><xi:include href="transitions.html" py:with="source=True"/></dd>
          <dt>Content</dt>
          <dd>${h.form.textarea('content', h.qsheet.as_text(qsheet), e, class_='span-22')}</dd>
          <dt>CSS styles</dt>
          <dd>${h.form.textarea('styles', qsheet.styles, e, class_='span-22')}</dd>
          <dt>Javascript</dt>
          <dd>${h.form.textarea('scripts', qsheet.scripts, e, class_='span-22')}</dd>
        </dl>
        <ul class="buttons span-22">
          <li>${h.form.button("Don't update", class_='button', onclick="document.location='%s'" % r.route_url('survey.qsheet.view', sid=survey.id, qsid=qsheet.id))}</li>
          <li>${h.form.submit('Update', class_='button')}</li>
        </ul>
      </form>
    </article>
  </body>
</html>
